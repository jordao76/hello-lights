<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: selectors/physical-multi-traffic-light-selector.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: selectors/physical-multi-traffic-light-selector.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const EventEmitter = require('events');
const {FlexMultiTrafficLight} = require('../traffic-light/multi-traffic-light');

////////////////////////////////////////////////

// the default device manager
const {Manager} = require('../devices/cleware-switch1');

////////////////////////////////////////////////

/**
 * Selects all available physical traffic lights to use in a composite.
 * @memberof selectors
 * @extends EventEmitter
 * @package
 */
class PhysicalMultiTrafficLightSelector extends EventEmitter {

  /**
   * Selects all available physical traffic lights to use.
   * Checks-out and uses all available traffic lights to issue commands.
   * @param {object} [options] - Options.
   * @param {physical.DeviceManager} [options.manager] - The Device Manager to use.
   * @param {commands.Interpreter} [options.interpreter] - The Command Interpreter to use.
   *   Used to define multi-traffic-light commands.
   */
  constructor({manager = Manager, interpreter = null} = {}) {
    super();
    this.manager = manager;
    this._setupCommands(interpreter);
    this._setupTrafficLight();
  }

  _setupTrafficLight() {
    this.manager.startMonitoring();
    this.trafficLight = new FlexMultiTrafficLight(this._retrieveTrafficLights());
    this.trafficLight.on('enabled', () =>
      /**
       * Fired when the multi traffic light gets enabled.
       * @event selectors.PhysicalMultiTrafficLightSelector#enabled
       */
      this.emit('enabled'));
    this.trafficLight.on('disabled', () =>
      /**
       * Fired when the multi traffic light gets disabled.
       * @event selectors.PhysicalMultiTrafficLightSelector#disabled
       */
      this.emit('disabled'));
    this.trafficLight.on('interrupted', () =>
      /**
       * Fired when the multi traffic light gets interrupted.
       * @event selectors.PhysicalMultiTrafficLightSelector#interrupted
       */
      this.emit('interrupted'));
    this.manager.on('added', () => {
      this._retrieveTrafficLights()
        .forEach(tl => this.trafficLight.add(tl));
    });
  }

  _setupCommands(interpreter) {
    if (!interpreter) return;
    const {defineCommands} = require('../traffic-light/multi-traffic-light-commands');
    defineCommands(interpreter);
  }

  _retrieveTrafficLights() {
    return this.manager.allDevices()
      .map(device => device.trafficLight)
      .filter(tl => tl.isAvailable);
  }

  /**
   * Called to close this instance and to stop monitoring for devices.
   * Should be done as the last operation before exiting the process.
   * @see physical.DeviceManager#stopMonitoring
   */
  close() {
    this.manager.stopMonitoring();
  }

  /**
   * Retrieves a multi traffic light for exclusive usage of the caller,
   * or `null` if no traffic lights are available.
   * @returns {trafficLight.FlexMultiTrafficLight} - A multi traffic light, or `null`.
   */
  resolveTrafficLight() {
    if (this.trafficLight.isEnabled) return this.trafficLight;
    return null;
  }

  /**
   * Logs information about known devices.
   * @param {object} [logger=console] - A Console-like object for logging.
   */
  logInfo(logger = console) {
    this.manager.logInfo(logger);
  }

}

////////////////////////////////////////////////

module.exports = {
  PhysicalMultiTrafficLightSelector,
  SelectorCtor: PhysicalMultiTrafficLightSelector
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="commands.html">commands</a></li><li><a href="physical.html">physical</a></li><li><a href="selectors.html">selectors</a></li><li><a href="trafficLight.html">trafficLight</a></li></ul><h3>Classes</h3><ul><li><a href="Commander.html">Commander</a></li><li><a href="commands.Cancellable.html">Cancellable</a></li><li><a href="commands.Formatter.html">Formatter</a></li><li><a href="commands.Interpreter.html">Interpreter</a></li><li><a href="physical.Device.html">Device</a></li><li><a href="physical.DeviceManager.html">DeviceManager</a></li><li><a href="physical.PhysicalLight.html">PhysicalLight</a></li><li><a href="physical.PhysicalTrafficLight.html">PhysicalTrafficLight</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html">PhysicalMultiTrafficLightSelector</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html">PhysicalTrafficLightSelector</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html">FlexMultiTrafficLight</a></li><li><a href="trafficLight.Light.html">Light</a></li><li><a href="trafficLight.MultiLight.html">MultiLight</a></li><li><a href="trafficLight.MultiTrafficLight.html">MultiTrafficLight</a></li><li><a href="trafficLight.TrafficLight.html">TrafficLight</a></li></ul><h3>Events</h3><ul><li><a href="physical.Device.html#event:connected">connected</a></li><li><a href="physical.Device.html#event:disconnected">disconnected</a></li><li><a href="physical.DeviceManager.html#event:added">added</a></li><li><a href="physical.DeviceManager.html#event:removed">removed</a></li><li><a href="physical.PhysicalTrafficLight.html#event:disabled">disabled</a></li><li><a href="physical.PhysicalTrafficLight.html#event:enabled">enabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:disabled">disabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:enabled">enabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:interrupted">interrupted</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html#event:disabled">disabled</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html#event:enabled">enabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:enabled">enabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:interrupted">interrupted</a></li><li><a href="trafficLight.MultiTrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.MultiTrafficLight.html#event:enabled">enabled</a></li><li><a href="trafficLight.TrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.TrafficLight.html#event:enabled">enabled</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Aug 26 2019 22:04:12 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
