<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: physical/usb-detector.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: physical/usb-detector.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//////////////////////////////////////////////

/**
 * A dummy USB detector that does not support USB monitoring.
 * To use in case the "usb-detection" module is not available.
 * @memberof physical
 */
class NullUsbDetector {

  /** No-op */
  startMonitoring() { }

  /** No-op */
  stopMonitoring() { }

  /** No-op */
  on(eventName, callback) { }

  /**
   * Whether this detector supports monitoring: if the detector detects.
   * @returns If the detector supports monitoring - always `false`.
   */
  supportsMonitoring() {
    return false;
  }

}

//////////////////////////////////////////////

/**
 * A wrapper for the "usb-detection" module.
 * It balances the number of calls to `stopMonitoring` to the previous number
 * of calls to `startMonitoring`.
 * See {@link https://github.com/MadLittleMods/node-usb-detection/|usb-detection}.
 * @memberof physical
 */
class UsbDetector {

  /**
   * @param usbDetect - The "usb-detection" module.
   */
  constructor(usbDetect) {
    this._usbDetect = usbDetect;
    this._monitoringCount = 0;
  }

  /**
   * Starts listening to USB events. Can be called multiple times.
   * Will prevent the process from exiting until `stopMonitoring` is called
   * a matching number of times.
   */
  startMonitoring() {
    if (this._monitoringCount === 0) {
      this._usbDetect.startMonitoring();
    }
    ++this._monitoringCount;
  }

  /**
   * Stops listening to USB events, and allows the process to exit,
   * but ONLY at the last call of a matching chain of `startMonitoring` calls.
   */
  stopMonitoring() {
    if (this._monitoringCount === 0) return;
    --this._monitoringCount;
    if (this._monitoringCount === 0) {
      this._usbDetect.stopMonitoring();
    }
  }

  /**
   * Register a callback to an USB event.
   * See {@link https://github.com/MadLittleMods/node-usb-detection/#usbdetectoneventname-callback|usbDetect#on}.
   * @param {string} eventName - Event name.
   * @param {function} callback - Event callback.
   */
  on(eventName, callback) {
    this._usbDetect.on(eventName, callback);
  }

  /**
   * Whether this detector supports monitoring: if the detector detects.
   * @returns If the detector supports monitoring - always `true`.
   */
  supportsMonitoring() {
    return true;
  }

}

//////////////////////////////////////////////

const tryRequire = path => {
  try {
    return require(path);
  } catch (e) {
    return null;
  }
};
// 'usb-detection' is an optional dependency, so it might not be available
const usbDetect = tryRequire('usb-detection');

/**
 * USB detector singleton. Either based on the "usb-detection" module
 * (see {@link https://github.com/MadLittleMods/node-usb-detection/|usb-detection}),
 * or a dummy object that does not support monitoring in case the "usb-detection"
 * module is not available (it's an optional dependency).
 * @memberof physical
 * @type {(UsbDetector|NullUsbDetector)}
 */
const usbDetector = usbDetect ? new UsbDetector(usbDetect) : new NullUsbDetector(); // singleton

//////////////////////////////////////////////

module.exports = {NullUsbDetector, UsbDetector, usbDetector};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="commands.html">commands</a></li><li><a href="physical.html">physical</a></li><li><a href="selectors.html">selectors</a></li><li><a href="trafficLight.html">trafficLight</a></li></ul><h3>Classes</h3><ul><li><a href="Commander.html">Commander</a></li><li><a href="commands.Cancellable.html">Cancellable</a></li><li><a href="commands.CodeFormatter.html">CodeFormatter</a></li><li><a href="commands.Interpreter.html">Interpreter</a></li><li><a href="commands.MetaFormatter.html">MetaFormatter</a></li><li><a href="physical.Device.html">Device</a></li><li><a href="physical.DeviceManager.html">DeviceManager</a></li><li><a href="physical.NullUsbDetector.html">NullUsbDetector</a></li><li><a href="physical.PhysicalLight.html">PhysicalLight</a></li><li><a href="physical.PhysicalTrafficLight.html">PhysicalTrafficLight</a></li><li><a href="physical.UsbDetector.html">UsbDetector</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html">PhysicalMultiTrafficLightSelector</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html">PhysicalTrafficLightSelector</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html">FlexMultiTrafficLight</a></li><li><a href="trafficLight.Light.html">Light</a></li><li><a href="trafficLight.MultiLight.html">MultiLight</a></li><li><a href="trafficLight.MultiTrafficLight.html">MultiTrafficLight</a></li><li><a href="trafficLight.TrafficLight.html">TrafficLight</a></li></ul><h3>Events</h3><ul><li><a href="physical.Device.html#event:connected">connected</a></li><li><a href="physical.Device.html#event:disconnected">disconnected</a></li><li><a href="physical.DeviceManager.html#event:added">added</a></li><li><a href="physical.DeviceManager.html#event:removed">removed</a></li><li><a href="physical.PhysicalTrafficLight.html#event:disabled">disabled</a></li><li><a href="physical.PhysicalTrafficLight.html#event:enabled">enabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:disabled">disabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:enabled">enabled</a></li><li><a href="selectors.PhysicalMultiTrafficLightSelector.html#event:interrupted">interrupted</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html#event:disabled">disabled</a></li><li><a href="selectors.PhysicalTrafficLightSelector.html#event:enabled">enabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:enabled">enabled</a></li><li><a href="trafficLight.FlexMultiTrafficLight.html#event:interrupted">interrupted</a></li><li><a href="trafficLight.MultiTrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.MultiTrafficLight.html#event:enabled">enabled</a></li><li><a href="trafficLight.TrafficLight.html#event:disabled">disabled</a></li><li><a href="trafficLight.TrafficLight.html#event:enabled">enabled</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Sep 08 2019 21:57:08 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
